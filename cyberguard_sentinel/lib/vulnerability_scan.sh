#!/bin/bash

# Function to check if Nmap is installed
function check_nmap() {
    command -v nmap >/dev/null 2>&1 || { 
        echo >&2 "Nmap is not installed. Please install Nmap before running this script."; 
        exit 1; 
    }
}

# Function to get user input for target IP and port
function get_target_info() {
    read -p "Enter the target IP address: " TARGET_IP
    read -p "Enter the target port (press Enter for default): " TARGET_PORT
    TARGET_PORT=${TARGET_PORT:-80}  # Default port is 80 if not specified
}

# Function to perform Nmap scan based on user's choice
function nmap_scan_options() {
    local choice=$1
    local target=$TARGET_IP
    local port=$TARGET_PORT

    case $choice in
        1) echo "Running Nmap Vulnerability Scan..."
           nmap -p $port --script vuln $target;;
        2) echo "Running Nmap Service Version Detection Scan..."
           nmap -p- -A --script=default,version $target;;
        3) echo "Running Nmap Vulnerability Scan with Vulners NSE Script..."
           nmap -p $port --script vulners $target;;
        4) echo "Running Nmap Heartbleed SSL Vulnerability Scan..."
           nmap --script ssl-heartbleed -p $port $target;;
        5) echo "Running Nmap SMB Vulnerability Scan..."
           nmap -p $port --script smb-vuln* $target;;
        6) echo "Running Nmap HTTP Vulnerability Scan..."
           nmap -p $port --script http-vuln* $target;;
        7) echo "Running Nmap DNS Zone Transfer Scan..."
           nmap --script dns-zone-transfer -p $port $target;;
        8) echo "Running Nmap Service Version Detection with Brute Force Scan..."
           nmap -p $port --script brute,brute-inet,brute-nmap,brute-ssh,brute-ftp -sV $target;;
        9) echo "Running Nmap SSL Information Gathering Scan..."
           nmap -p $port --script ssl-cert,ssl-enum-ciphers,ssl-ccs-injection,ssl-dh-params,ssl-heartbleed,ssl-poodle,ssl-known-key,ssl-ccs-injection -oN ssl_info_results.txt $target;;
        10) echo "Running Nmap SNMP Enumeration Scan..."
            nmap -p $port --script snmp-brute,snmp-info,snmp-netstat,snmp-processes,snmp-sysdescr,snmp-sysinfo,snmp-win32-users,snmp-win32-shares -oN snmp_enum_results.txt $target;;
        11) echo "Running Nmap SMB Enumeration Scan..."
            nmap -p $port --script smb-enum-domains,smb-enum-groups,smb-enum-processes,smb-enum-sessions,smb-enum-shares,smb-enum-users,smb-enum-users-sets,smb-ls,smb-mbenum,smb-os-discovery,smb-print-text,smb-psexec,smb-security-mode,smb-vuln* -oN smb_enum_results.txt $target;;
        12) echo "Running Nmap SMTP Enumeration Scan..."
            nmap -p $port --script smtp-commands,smtp-enum-users,smtp-open-relay,smtp-ntlm-info,smtp-vuln-cve2011-1764 -oN smtp_enum_results.txt $target;;
        13) echo "Running Nmap FTP Enumeration Scan..."
            nmap -p $port --script ftp-anon,ftp-bounce,ftp-libopie,ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221 -oN ftp_enum_results.txt $target;;
        14) echo "Running Nmap RPC Enumeration Scan..."
            nmap -p $port --script rpc-grind,rpcinfo -oN rpc_enum_results.txt $target;;
        15) echo "Running Nmap NFS Enumeration Scan..."
            nmap -p $port --script nfs-ls,nfs-showmount,nfs-statfs,nfs-exportfs -oN nfs_enum_results.txt $target;;
        16) echo "Running Nmap SIP Enumeration Scan..."
            nmap -p $port --script sip-methods,sip-call-spoof,sip-uri-brute,sip-enum-users,sip-enum-passwords,sip-vuln* -oN sip_enum_results.txt $target;;
        17) echo "Running Nmap Oracle Enumeration Scan..."
            nmap -p $port --script oracle-brute,oracle-sid-brute,oracle-tns-version,oracle-sid-list,oracle-enum-users -oN oracle_enum_results.txt $target;;
        18) echo "Running Nmap MongoDB Enumeration Scan..."
            nmap -p $port --script mongodb-databases,mongodb-info -oN mongodb_enum_results.txt $target;;
        19) echo "Running Nmap Cisco Enumeration Scan..."
            nmap -p $port --script cisco-anyconnect,cisco-config,tftp-enum -oN cisco_enum_results.txt $target;;
        20) echo "Running Nmap VPN Enumeration Scan..."
            nmap -p $port --script vpnc,ike-version,ike-enum-phase1-v1,ike-enum-phase1 -oN vpn_enum_results.txt $target;;
        21) echo "Running Nmap MS-SQL Enumeration Scan..."
            nmap -p $port --script ms-sql-info,ms-sql-config,ms-sql-brute,ms-sql-xp-cmdshell -oN mssql_enum_results.txt $target;;
        22) echo "Running Nmap VNC Enumeration Scan..."
            nmap -p $port --script vnc-info,vnc-title,vnc-auth-bypass,vnc-brute -oN vnc_enum_results.txt $target;;
        23) echo "Running Nmap SNMP Brute Force Scan..."
            nmap -p $port --script snmp-brute -oN snmp_brute_results.txt $target;;
        24) echo "Running Nmap SSL Renegotiation Scan..."
            nmap --script ssl-enum-ciphers -p $port --script-args ssl-enum-ciphers.reneg -oN ssl_reneg_results.txt $target;;
        25) echo "Running Nmap Heartbleed SSL Vulnerability Scan..."
            nmap -p $port --script ssl-heartbleed -oN heartbleed_results.txt $target;;
        *)
            echo "Invalid choice. Please enter a valid option."
            ;;
    esac
}

# Function to display vulnerability scan options
function vulnerability_scan_options() {
    echo "Select Nmap scan options for vulnerability scan:"
    echo "1. Vulnerability Scan"
    echo "2. Service Version Detection Scan"
    echo "3. Vulnerability Scan with Vulners NSE Script"
    echo "4. Heartbleed SSL Vulnerability Scan"
    echo "5. SMB Vulnerability Scan"
    echo "6. HTTP Vulnerability Scan"
    echo "7. DNS Zone Transfer Scan"
    echo "8. Service Version Detection with Brute Force Scan"
    echo "9. SSL Information Gathering Scan"
    echo "10. SNMP Enumeration Scan"
    echo "11. SMB Enumeration Scan"
    echo "12. SMTP Enumeration Scan"
    echo "13. FTP Enumeration Scan"
    echo "14. RPC Enumeration Scan"
    echo "15. NFS Enumeration Scan"
    echo "16. SIP Enumeration Scan"
    echo "17. Oracle Enumeration Scan"
    echo "18. MongoDB Enumeration Scan"
    echo "19. Cisco Enumeration Scan"
    echo "20. VPN Enumeration Scan"
    echo "21. MS-SQL Enumeration Scan"
    echo "22. VNC Enumeration Scan"
    echo "23. SNMP Brute Force Scan"
    echo "24. SSL Renegotiation Scan"
    echo "25. Heartbleed SSL Vulnerability Scan"
    echo "0. Return to Main Menu"

    read -p "Enter your choice: " user_choice

    if [[ $user_choice == 0 ]]; then
        return  # User chose to return to the main menu
    fi

    get_target_info  # Get target IP and port from the user

    nmap_scan_options $user_choice  # Perform the selected Nmap scan
}

# Main function to start vulnerability scanning
function main() {
    check_nmap  # Check if Nmap is installed
    vulnerability_scan_options  # Call the vulnerability scan options function
}

# Call the main function
main
